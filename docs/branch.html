---

title: Branch Wizardry 

keywords: fastai
sidebar: home_sidebar

summary: "Summary"
description: "Summary"
nb_path: "05_branch.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05_branch.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instant branching and merging are the most lethal of Git's killer features.</p>
<p><em>Problem</em>: External factors inevitably necessitate context switching. A severe
bug manifests in the released version without warning. The deadline for a
certain feature is moved closer. A developer whose help you need for a key section of the project is about to leave. In all cases, you must abruptly drop what you are doing and focus on a completely different task.</p>
<p>Interrupting your train of thought can be detrimental to your productivity, and the more cumbersome it is to switch contexts, the greater the loss. With centralized version control we must download a fresh working copy from the central server. Distributed systems fare better, as we can clone the desired version locally.</p>
<p>But cloning still entails copying the whole working directory as well as the entire history up to the given point. Even though Git reduces the cost of this with file sharing and hard links, the project files themselves must be recreated in their entirety in the new working directory.</p>
<p><em>Solution</em>: Git has a better tool for these situations that is much faster and more space-efficient than cloning: <em>git branch</em>.</p>
<p>With this magic word, the files in your directory suddenly shapeshift from one version to another. This transformation can do more than merely go back or forward in history. Your files can morph from the last release to the experimental version to the current development version to your friend's version and so on.</p>
<h3 id="The-Boss-Key">The Boss Key<a class="anchor-link" href="#The-Boss-Key"> </a></h3><p>Ever played one of those games where at the push of a button (``the boss key''), the screen would instantly display a spreadsheet or something? So if the boss walked in the office while you were playing the game you could quickly hide it away?</p>
<p>In some directory:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> <span class="nb">echo</span> <span class="s2">&quot;I&#39;m smarter than my boss&quot;</span> &gt; myfile.txt
 <span class="o">!</span> git init
 <span class="o">!</span> git add .
 <span class="o">!</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have created a Git repository that tracks one text file containing a certain message. Now type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout -b boss  # nothing seems to change after this
 <span class="o">!</span> <span class="nb">echo</span> <span class="s2">&quot;My boss is smarter than me&quot;</span> &gt; myfile.txt
 <span class="o">!</span> git commit -a -m <span class="s2">&quot;Another commit&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It looks like we've just overwritten our file and committed it. But it's an illusion. Type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout master  # switch to original version of the file
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and hey presto! The text file is restored. And if the boss decides to snoop around this directory, type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout boss  # switch to version suitable <span class="k">for</span> boss<span class="err">&#39;</span> eyes
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can switch between the two versions of the file as much as you like, and commit to each independently.</p>
<h3 id="Dirty-Work">Dirty Work<a class="anchor-link" href="#Dirty-Work"> </a></h3><p>[[branch]]
Say you're working on some feature, and for some reason, you need to go back three versions and temporarily put in a few print statements to see how something works. Then:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git commit -a
 <span class="o">!</span> git checkout HEAD~3
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now you can add ugly temporary code all over the place. You can even commit these changes. When you're done,</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout master
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>to return to your original work. Observe that any uncommitted changes are carried over.</p>
<p>What if you wanted to save the temporary changes after all? Easy:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout -b dirty
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and commit before switching back to the master branch. Whenever you want to return to the dirty changes, simply type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout dirty
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We touched upon this command in an earlier chapter, when discussing loading old states. At last we can tell the whole story: the files change to the requested state, but we must leave the master branch. Any commits made from now on take your files down a different road, which can be named later.</p>
<p>In other words, after checking out an old state, Git automatically puts you in a new, unnamed branch, which can be named and saved with <em>git checkout -b</em>.</p>
<h3 id="Quick-Fixes">Quick Fixes<a class="anchor-link" href="#Quick-Fixes"> </a></h3><p>You're in the middle of something when you are told to drop everything and fix a newly discovered bug in commit <code>1b6d...</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git commit -a
 <span class="o">!</span> git checkout -b fixes 1b6d
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then once you've fixed the bug:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git commit -a -m <span class="s2">&quot;Bug fixed&quot;</span>
 <span class="o">!</span> git checkout master
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and resume work on your original task. You can even 'merge' in the freshly
baked bugfix:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git merge fixes
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Merging">Merging<a class="anchor-link" href="#Merging"> </a></h3><p>With some version control systems, creating branches is easy but merging them
back together is tough. With Git, merging is so trivial that you might be
unaware of it happening.</p>
<p>We actually encountered merging long ago. The <em>pull</em> command in fact 'fetches'
commits and then merges them into your current branch. If you have no local
changes, then the merge is a 'fast forward', a degenerate case akin to fetching
the latest version in a centralized version control system. But if you do have
local changes, Git will automatically merge, and report any conflicts.</p>
<p>Ordinarily, a commit has exactly one 'parent commit', namely, the previous
commit. Merging branches together produces a commit with at least two parents.
This begs the question: what commit does <code>HEAD~10</code> really refer to? A commit
could have multiple parents, so which one do we follow?</p>
<p>It turns out this notation chooses the first parent every time. This is
desirable because the current branch becomes the first parent during a merge;
frequently you're only concerned with the changes you made in the current
branch, as opposed to changes merged in from other branches.</p>
<p>You can refer to a specific parent with a caret. For example, to show
the logs from the second parent:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git log HEAD^2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You may omit the number for the first parent. For example, to show the
differences with the first parent:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git diff HEAD^
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can combine this notation with other types. For example:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout 1b6d^^2~10 -b ancient
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>starts a new branch ``ancient'' representing the state 10 commits back from the
second parent of the first parent of the commit starting with 1b6d.</p>
<h3 id="Uninterrupted-Workflow">Uninterrupted Workflow<a class="anchor-link" href="#Uninterrupted-Workflow"> </a></h3><p>Often in hardware projects, the second step of a plan must await the completion of the first step. A car undergoing repairs might sit idly in a garage until a particular part arrives from the factory. A prototype might wait for a chip to be fabricated before construction can continue.</p>
<p>Software projects can be similar. The second part of a new feature may have to
wait until the first part has been released and tested. Some projects require
your code to be reviewed before accepting it, so you might wait until the first
part is approved before starting the second part.</p>
<p>Thanks to painless branching and merging, we can bend the rules and work on
Part II before Part I is officially ready. Suppose you have committed Part I
and sent it for review. Let's say you're in the <code>master</code> branch. Then branch
off:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout -b part2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, work on Part II, committing your changes along the way. To err is human,
and often you'll want to go back and fix something in Part I.
If you're lucky, or very good, you can skip these lines.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout master  # Go back to Part I.
 <span class="o">!</span> fix_problem
 <span class="o">!</span> git commit -a        # Commit the fixes.
 <span class="o">!</span> git checkout part2   # Go back to Part II.
 <span class="o">!</span> git merge master     # Merge in those fixes.
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Eventually, Part I is approved:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout master  # Go back to Part I.
 <span class="o">!</span> submit files         # Release to the world!
 <span class="o">!</span> git merge part2      # Merge in Part II.
 <span class="o">!</span> git branch -d part2  # Delete <span class="s2">&quot;part2&quot;</span> branch.
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now you're in the <code>master</code> branch again, with Part II in the working directory.</p>
<p>It's easy to extend this trick for any number of parts. It's also easy to
branch off retroactively: suppose you belatedly realize you should have created
a branch 7 commits ago. Then type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git branch -m master part2  # Rename <span class="s2">&quot;master&quot;</span> branch to <span class="s2">&quot;part2&quot;</span>.
 <span class="o">!</span> git branch master HEAD~7    # Create new <span class="s2">&quot;master&quot;</span>, <span class="m">7</span> commits upstream.
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>master</code> branch now contains just Part I, and the <code>part2</code> branch contains
the rest. We are in the latter branch; we created <code>master</code> without switching to
it, because we want to continue work on <code>part2</code>. This is unusual. Until now,
we've been switching to branches immediately after creation, as in:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout HEAD~7 -b master  # Create a branch, and switch to it.
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Reorganizing-a-Medley">Reorganizing a Medley<a class="anchor-link" href="#Reorganizing-a-Medley"> </a></h3><p>Perhaps you like to work on all aspects of a project in the same branch. You want to keep works-in-progress to yourself and want others to see your commits only when they have been neatly organized. Start a couple of branches:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git branch sanitized    # Create a branch <span class="k">for</span> sanitized commits.
  <span class="o">!</span> git checkout -b medley  # Create and switch to a branch to work in.
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, work on anything: fix bugs, add features, add temporary code, and so forth, committing often along the way. Then:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git checkout sanitized
  <span class="o">!</span> git cherry-pick medley^^
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>applies the grandparent of the head commit of the <code>medley'' branch to the</code>sanitized'' branch. With appropriate cherry-picks you can construct a branch that contains only permanent code, and has related commits grouped together.</p>
<h3 id="Managing-Branches">Managing Branches<a class="anchor-link" href="#Managing-Branches"> </a></h3><p>List all branches by typing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git branch
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By default, you start in a branch named <code>master''. Some advocate leaving the</code>master'' branch untouched and creating new branches for your own edits.</p>
<p>The <em>-d</em> and <em>-m</em> options allow you to delete and move (rename) branches.
See <em>git help branch</em>.</p>
<p>The <code>master'' branch is a useful custom. Others may assume that your
repository has a branch with this name, and that it contains the official
version of your project. Although you can rename or obliterate the</code>master''
branch, you might as well respect this convention.</p>
<h3 id="Temporary-Branches">Temporary Branches<a class="anchor-link" href="#Temporary-Branches"> </a></h3><p>After a while you may realize you are creating short-lived branches
frequently for similar reasons: every other branch merely serves to
save the current state so you can briefly hop back to an older state to
fix a high-priority bug or something.</p>
<p>It's analogous to changing the TV channel temporarily to see what else is on.
But instead of pushing a couple of buttons, you have to create, check out,
merge, and delete temporary branches. Luckily, Git has a shortcut that is as
convenient as a TV remote control:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git stash
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This saves the current state in a temporary location (a 'stash') and
restores the previous state. Your working directory appears exactly as it was
before you started editing, and you can fix bugs, pull in upstream changes, and
so on. When you want to go back to the stashed state, type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git stash apply  # You may need to resolve some conflicts.
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can have multiple stashes, and manipulate them in various ways. See
<em>git help stash</em>. As you may have guessed, Git maintains branches behind the scenes to perform this magic trick.</p>
<h3 id="Work-How-You-Want">Work How You Want<a class="anchor-link" href="#Work-How-You-Want"> </a></h3><p>You might wonder if branches are worth the bother. After all, clones are almost
as fast, and you can switch between them with <em>cd</em> instead of esoteric Git
commands.</p>
<p>Consider web browsers. Why support multiple tabs as well as multiple windows?
Because allowing both accommodates a wide variety of styles. Some users like to
keep only one browser window open, and use tabs for multiple webpages. Others
might insist on the other extreme: multiple windows with no tabs anywhere.
Others still prefer something in between.</p>
<p>Branching is like tabs for your working directory, and cloning is like opening
a new browser window. These operations are fast and local, so why not
experiment to find the combination that best suits you? Git lets you work
exactly how you want.</p>

</div>
</div>
</div>
</div>
 

