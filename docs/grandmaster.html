---

title: Git Grandmastery 

keywords: fastai
sidebar: home_sidebar

summary: "Summary"
description: "Summary"
nb_path: "07_grandmaster.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 07_grandmaster.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By now, you should be able to navigate the <em>git help</em> pages and understand
almost everything. However, pinpointing the exact command required to solve a
given problem can be tedious. Perhaps I can save you some time: below are some
recipes I have needed in the past.</p>
<h3 id="Source-Releases">Source Releases<a class="anchor-link" href="#Source-Releases"> </a></h3><p>For my projects, Git tracks exactly the files I'd like to archive and release
to users. To create a tarball of the source code, I run:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git archive --format<span class="o">=</span>tar --prefix<span class="o">=</span>proj-1.2.3/ HEAD
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Commit-What-Changed">Commit What Changed<a class="anchor-link" href="#Commit-What-Changed"> </a></h3><p>Telling Git when you've added, deleted and renamed files is troublesome for
certain projects. Instead, you can type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git add .
 <span class="o">!</span> git add -u
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Git will look at the files in the current directory and work out the details by
itself. Instead of the second add command, run <code>git commit -a</code> if you also
intend to commit at this time. See <em>git help ignore</em> for how to specify files
that should be ignored.</p>
<p>You can perform the above in a single pass with:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git ls-files -d -m -o -z <span class="p">|</span> xargs -0 git update-index --add --remove
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <em>-z</em> and <em>-0</em> options prevent ill side-effects from filenames containing
strange characters. As this command adds ignored files, you may want to use the
<code>-x</code> or <code>-X</code> option.</p>
<h3 id="My-Commit-Is-Too-Big!">My Commit Is Too Big!<a class="anchor-link" href="#My-Commit-Is-Too-Big!"> </a></h3><p>Have you neglected to commit for too long? Been coding furiously and forgotten
about source control until now? Made a series of unrelated changes, because
that's your style?</p>
<p>No worries. Run:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git add -p
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For each edit you made, Git will show you the hunk of code that was changed,
and ask if it should be part of the next commit. Answer with "y" or "n". You
have other options, such as postponing the decision; type "?" to learn more.</p>
<p>Once you're satisfied, type</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git commit
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>to commit precisely the changes you selected (the 'staged' changes). Make sure
you omit the <em>-a</em> option, otherwise Git will commit all the edits.</p>
<p>What if you've edited many files in many places? Reviewing each change one by
one becomes frustratingly mind-numbing. In this case, use <em>git add -i</em>, whose
interface is less straightforward, but more flexible. With a few keystrokes,
you can stage or unstage several files at a time, or review and select changes
in particular files only. Alternatively, run <em>git commit --interactive</em> which
automatically commits after you're done.</p>
<h3 id="The-Index:-Git's-Staging-Area">The Index: Git's Staging Area<a class="anchor-link" href="#The-Index:-Git's-Staging-Area"> </a></h3><p>So far we have avoided Git's famous 'index', but we must now confront it to
explain the above. The index is a temporary staging area. Git seldom shuttles
data directly between your project and its history. Rather, Git first writes
data to the index, and then copies the data in the index to its final
destination.</p>
<p>For example, <em>commit -a</em> is really a two-step process. The first step places a
snapshot of the current state of every tracked file into the index. The second
step permanently records the snapshot now in the index. Committing without the
<em>-a</em> option only performs the second step, and only makes sense after running
commands that somehow change the index, such as <em>git add</em>.</p>
<p>Usually we can ignore the index and pretend we are reading straight from and writing straight to the history. On this occasion, we want finer control, so we manipulate the index. We place a snapshot of some, but not all, of our changes into the index, and then permanently record this carefully rigged snapshot.</p>
<h3 id="Don't-Lose-Your-HEAD">Don't Lose Your HEAD<a class="anchor-link" href="#Don't-Lose-Your-HEAD"> </a></h3><p>The HEAD tag is like a cursor that normally points at the latest commit, advancing with each new commit. Some Git commands let you move it. For example:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git reset HEAD~3
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>will move the HEAD three commits back. Thus all Git commands now act as if you hadn't made those last three commits, while your files remain in the present. See the help page for some applications.</p>
<p>But how can you go back to the future? The past commits know nothing of the future.</p>
<p>If you have the SHA1 of the original HEAD then:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git reset 1b6d
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But suppose you never took it down? Don't worry: for commands like these, Git saves the original HEAD as a tag called ORIG_HEAD, and you can return safe and sound with:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git reset ORIG_HEAD
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="HEAD-hunting">HEAD-hunting<a class="anchor-link" href="#HEAD-hunting"> </a></h3><p>Perhaps ORIG_HEAD isn't enough. Perhaps you've just realized you made a monumental mistake and you need to go back to an ancient commit in a long-forgotten branch.</p>
<p>By default, Git keeps a commit for at least two weeks, even if you ordered
Git to destroy the branch containing it. The trouble is finding the appropriate
hash. You could look at all the hash values in <code>.git/objects</code> and use trial
and error to find the one you want. But there's a much easier way.</p>
<p>Git records every hash of a commit it computes in <code>.git/logs</code>. The subdirectory <code>refs</code> contains the history of all activity on all branches, while the file <code>HEAD</code> shows every hash value it has ever taken. The latter can be used to find hashes of commits on branches that have been accidentally lopped off.</p>
<p>The reflog command provides a friendly interface to these log files. Try</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git reflog
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instead of cutting and pasting hashes from the reflog, try:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout <span class="s2">&quot;@{10 minutes ago}&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Or checkout the 5th-last visited commit via:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> git checkout <span class="s2">&quot;@{5}&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See the ``Specifying Revisions'' section of <em>git help rev-parse</em> for more.</p>
<p>You may wish to configure a longer grace period for doomed commits. For
example:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git config gc.pruneexpire <span class="s2">&quot;30 days&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>means a deleted commit will only be permanently lost once 30 days have passed
and <em>git gc</em> is run.</p>
<p>You may also wish to disable automatic invocations of <em>git gc</em>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git config gc.auto <span class="m">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>in which case commits will only be deleted when you run <em>git gc</em> manually.</p>
<h3 id="Building-On-Git">Building On Git<a class="anchor-link" href="#Building-On-Git"> </a></h3><p>In true UNIX fashion, Git's design allows it to be easily used as a low-level component of other programs, such as GUI and web interfaces, alternative command-line interfaces, patch managements tools, importing and conversion tools and so on. In fact, some Git commands are themselves scripts standing on the shoulders of giants. With a little tinkering, you can customize Git to suit your preferences.</p>
<p>One easy trick is to use built-in Git aliases to shorten your most frequently
used commands:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git config --global alias.co checkout
  <span class="o">!</span> git config --global --get-regexp <span class="nb">alias</span>  # display current aliases
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>alias.co checkout</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git co foo                              # same as <span class="s1">&#39;git checkout foo&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Another is to print the current branch in the prompt, or window title.
Invoking</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git symbolic-ref HEAD
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>shows the current branch name. In practice, you most likely want to remove
the "refs/heads/" and ignore errors:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git symbolic-ref HEAD <span class="m">2</span>&gt; /dev/null <span class="p">|</span> cut -b <span class="m">12</span>-
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The +contrib+ subdirectory is a treasure trove of tools built on Git.
In time, some of them may be promoted to official commands. On Debian and
Ubuntu, this directory lives at +/usr/share/doc/git-core/contrib+.</p>
<p>One popular resident is +workdir/git-new-workdir+. Via clever symlinking, this script creates a new working directory whose history is shared with the original repository:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git-new-workdir an/existing/repo new/directory
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The new directory and the files within can be thought of as a clone, except since the history is shared, the two trees automatically stay in sync. There's no need to merge, push, or pull.</p>
<h3 id="Daring-Stunts">Daring Stunts<a class="anchor-link" href="#Daring-Stunts"> </a></h3><p>These days, Git makes it difficult for the user to accidentally destroy data.
But if you know what you are doing, you can override safeguards for common
commands.</p>
<p><em>Checkout</em>: Uncommitted changes cause checkout to fail. To destroy your changes, and checkout a given commit anyway, use the force flag:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git checkout -f HEAD^
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>On the other hand, if you specify particular paths for checkout, then there are no safety checks. The supplied paths are quietly overwritten. Take care if you use checkout in this manner.</p>
<p><em>Reset</em>: Reset also fails in the presence of uncommitted changes. To force it through, run:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git reset --hard 1b6d
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Branch</em>: Deleting branches fails if this causes changes to be lost. To force a deletion, type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git branch -D dead_branch  # instead of -d
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similarly, attempting to overwrite a branch via a move fails if data loss would ensue. To force a branch move, type:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git branch -M <span class="nb">source</span> target  # instead of -m
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unlike checkout and reset, these two commands defer data destruction. The
changes are still stored in the .git subdirectory, and can be retrieved by
recovering the appropriate hash from <code>.git/logs</code> (see "HEAD-hunting" above).
By default, they will be kept for at least two weeks.</p>
<p><em>Clean</em>: Some git commands refuse to proceed because they're worried about
clobbering untracked files. If you're certain that all untracked files and
directories are expendable, then delete them mercilessly with:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>  <span class="o">!</span> git clean -f -d
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next time, that pesky command will work!</p>
<h3 id="Preventing-Bad-Commits">Preventing Bad Commits<a class="anchor-link" href="#Preventing-Bad-Commits"> </a></h3><p>Stupid mistakes pollute my repositories. Most frightening are missing files due
to a forgotten <em>git add</em>. Lesser transgressions are trailing whitespace and
unresolved merge conflicts: though harmless, I wish these never appeared on the
public record.</p>
<p>If only I had bought idiot insurance by using a <em>hook</em> to alert me about these problems:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="o">!</span> <span class="nb">cd</span> .git/hooks
 <span class="o">!</span> cp pre-commit.sample pre-commit  # Older Git versions: chmod +x pre-commit
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now Git aborts a commit if useless whitespace or unresolved merge conflicts are
detected.</p>
<p>For this guide, I eventually added the following to the beginning of the
<em>pre-commit</em> hook to guard against absent-mindedness:</p>
<p>if git ls-files -o | grep '.txt$'; then
   echo FAIL! Untracked .txt files.
   exit 1
 fi</p>
<p>Several git operations support hooks; see <em>git help hooks</em>. We activated the
sample <em>post-update</em> hook earlier when discussing Git over HTTP. This runs
whenever the head moves. The sample post-update script updates files Git needs
for communication over Git-agnostic transports such as HTTP.</p>

</div>
</div>
</div>
</div>
 

